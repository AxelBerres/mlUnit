<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of fail</title>
  <meta name="keywords" content="fail">
  <meta name="description" content="FAIL Raise an error.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">src</a> &gt; <a href="index.html">assertions</a> &gt; fail.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src\assertions&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>fail
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>FAIL Raise an error.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function fail(msg, varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">FAIL Raise an error.
  FAIL(MSG, varargin) raises a MATLAB error. MSG is a string containing
  the fail message. MSG may contain sprintf arguments, which can be
  expanded by subsequent arguments in varargin. MSG will only be sprintf-
  evaluated if subsequent arguments are actually provided.

  The resulting error message will also contain a stack trace.

  Examples
     % raises a failure with a simple message
     fail('Test failed.');

     % raises a failure with a sprintf message, expanded by a variable
     fail('Test failed, because 3 was not %d.', number);</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="assert_empty.html" class="code" title="function assert_empty(expr, varargin)">assert_empty</a>	ASSERT_EMPTY Raise an error if expression does not evaluate to empty.</li><li><a href="assert_error.html" class="code" title="function assert_error(func, errspec, msg)">assert_error</a>	ASSERT_ERROR Raise an error if a call does not throw an error.</li><li><a href="assert_false.html" class="code" title="function assert_false(expr, varargin)">assert_false</a>	ASSERT_FALSE Raise an error if expression evaluates to true.</li><li><a href="assert_matfile_equals.html" class="code" title="function assert_matfile_equals(expected, actual)">assert_matfile_equals</a>	ASSERT_MATFILE_EQUALS Raise an error if two mat Files differ.</li><li><a href="assert_not_empty.html" class="code" title="function assert_not_empty(expr, varargin)">assert_not_empty</a>	ASSERT_NOT_EMPTY Raise an error if expression evaluates to empty.</li><li><a href="assert_true.html" class="code" title="function assert_true(expr, varargin)">assert_true</a>	ASSERT_TRUE Raise an error if expression does not evaluate to true.</li><li><a href="assert_warning.html" class="code" title="function assert_warning(func, warnid)">assert_warning</a>	ASSERT_WARNING Raise an error if a function does not issue a specific warning.</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function fail(msg, varargin)</a>
0002 <span class="comment">%FAIL Raise an error.</span>
0003 <span class="comment">%  FAIL(MSG, varargin) raises a MATLAB error. MSG is a string containing</span>
0004 <span class="comment">%  the fail message. MSG may contain sprintf arguments, which can be</span>
0005 <span class="comment">%  expanded by subsequent arguments in varargin. MSG will only be sprintf-</span>
0006 <span class="comment">%  evaluated if subsequent arguments are actually provided.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%  The resulting error message will also contain a stack trace.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%  Examples</span>
0011 <span class="comment">%     % raises a failure with a simple message</span>
0012 <span class="comment">%     fail('Test failed.');</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%     % raises a failure with a sprintf message, expanded by a variable</span>
0015 <span class="comment">%     fail('Test failed, because 3 was not %d.', number);</span>
0016 
0017 <span class="comment">%  This Software and all associated files are released unter the</span>
0018 <span class="comment">%  GNU General Public License (GPL), see LICENSE for details.</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%  $Author: hetu $</span>
0021 <span class="comment">%  $Id: fail.m 132 2015-01-08 13:12:51Z hetu $</span>
0022 
0023 <span class="comment">% set empty message if left empty, take msg, or interpret sprintf arguments</span>
0024 <span class="keyword">switch</span> nargin
0025 <span class="keyword">case</span> 0
0026    msg_string = <span class="string">'(No failure message provided)'</span>;
0027 <span class="keyword">case</span> 1
0028    msg_string = msg;
0029 <span class="keyword">otherwise</span>
0030    <span class="comment">% avoid multiple sprintf calls on msg in case msg contains masked</span>
0031    <span class="comment">% sprintf control sequences that should not be interpreted</span>
0032    msg_string = sprintf(msg, varargin{:});
0033 <span class="keyword">end</span>
0034 
0035 <span class="comment">% get calling stack with absolute file names</span>
0036 stack = dbstack(<span class="string">'-completenames'</span>);
0037 <span class="comment">% But also extract the file names only. The resulting stack.filename are</span>
0038 <span class="comment">% the names of the files each function call occurred, stack.name are the</span>
0039 <span class="comment">% names of each (sub)function, which we do not know or want to filter by.</span>
0040 [filepaths filenames] = cellfun(@fileparts, {stack.file}, <span class="string">'UniformOutput'</span>, 0);
0041 [stack.filename] = filenames{:};
0042 <span class="comment">% Pop all internal delegating assert calls from the stack. Assumes that we</span>
0043 <span class="comment">% are getting called through a chain of files named assert, assert_* or</span>
0044 <span class="comment">% fail. Stop at the first item not one of the list names.</span>
0045 filtered_files = {<span class="string">'assert_true'</span>, <span class="keyword">...</span>
0046                   <span class="string">'assert_false'</span>, <span class="keyword">...</span>
0047                   <span class="string">'assert_equals'</span>, <span class="keyword">...</span>
0048                   <span class="string">'assert_not_equals'</span>, <span class="keyword">...</span>
0049                   <span class="string">'assert_empty'</span>, <span class="keyword">...</span>
0050                   <span class="string">'assert_not_empty'</span>, <span class="keyword">...</span>
0051                   <span class="string">'assert_error'</span>, <span class="keyword">...</span>
0052                   <span class="string">'assert_warning'</span>, <span class="keyword">...</span>
0053                   <span class="string">'abstract_assert_equals'</span>, <span class="keyword">...</span>
0054                   <span class="string">'fail'</span>, <span class="keyword">...</span>
0055                   };
0056 <span class="keyword">while</span> ~isempty(stack) &amp;&amp; any(strcmpi(stack(1).filename, filtered_files))
0057     stack(1)=[];
0058 <span class="keyword">end</span>
0059 
0060 <span class="comment">% Pop all internal managing calls from the stack. These are at the back, i.e.</span>
0061 <span class="comment">% higher in the call chain. For failures, these are of no interest and only</span>
0062 <span class="comment">% muddle the output. Delete everything after the last/highest-up occurrence of</span>
0063 <span class="comment">% the test file. Use the test file in order to account for test functions, but</span>
0064 <span class="comment">% also tear_down and set_up.</span>
0065 first_handler_idx = find(strcmp({stack.filename}, <span class="string">'run_test'</span>), 1, <span class="string">'first'</span>);
0066 stack(first_handler_idx:end) = [];
0067 
0068 <span class="comment">% might also have been called from the MATLAB console</span>
0069 <span class="keyword">if</span> isempty(stack)
0070    stack(1).file = <span class="string">'MATLABConsole'</span>;
0071    stack(1).line = NaN;
0072 <span class="keyword">end</span>
0073 
0074 <span class="comment">% Build up the stack trace from here.</span>
0075 stacktrace = <span class="string">''</span>;
0076 <span class="keyword">for</span> i = 1:length(stack)
0077     stacktrace = [stacktrace, <span class="keyword">...</span>
0078         sprintf(<span class="string">'\nIn %s at line %d.'</span>, stack(i).file, stack(i).line)];  <span class="comment">%#ok&lt;AGROW&gt;</span>
0079 <span class="keyword">end</span>;
0080 
0081 <span class="comment">% throw error; 'MLUNIT FAILURE' string is used for masking actual error message</span>
0082 errmsg = [<span class="string">'MLUNIT FAILURE:'</span>, <span class="keyword">...</span>
0083    msg_string, <span class="keyword">...</span>
0084    stacktrace];
0085 
0086 <span class="comment">% raise typed error, mask message string in order to prevent further sprintf expansion</span>
0087 error(<span class="string">'MLUNIT:Failure'</span>, <span class="string">'%s'</span>, errmsg);</pre></div>
<hr><address>Generated on Thu 08-Jan-2015 14:45:23 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>