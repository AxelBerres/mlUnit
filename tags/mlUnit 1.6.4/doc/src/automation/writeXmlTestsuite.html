<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of writeXmlTestsuite</title>
  <meta name="keywords" content="writeXmlTestsuite">
  <meta name="description" content="WRITEXMLTESTSUITE Write the result of a test suite as jUnit compatible XML file.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">src</a> &gt; <a href="index.html">automation</a> &gt; writeXmlTestsuite.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src\automation&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>writeXmlTestsuite
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>WRITEXMLTESTSUITE Write the result of a test suite as jUnit compatible XML file.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function writeXmlTestsuite(suiteresult, targetdir) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> WRITEXMLTESTSUITE Write the result of a test suite as jUnit compatible XML file.

 WRITEXMLTESTSUITE(suiteresult, targetdir)

 Input argument suiteresult is a structure of these fields:
  name           the package name of the test suite
  errors         the number of errors
  failures       the number of failures
  tests          the number of executed tests
  time           the time used for executing the tests
  testcaseList   a list of all testcases with specific information

  Input argument targetdir defines the target directory for the XML
  report.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function xml = printXmlTestsuite(suiteresult)</a></li><li><a href="#_sub2" class="code">function xml = printXmlTestcase(testcase)</a></li><li><a href="#_sub3" class="code">function message = sanitizeHtml(message)</a></li><li><a href="#_sub4" class="code">function xml = xmlTag(tagname, attributes, content)</a></li><li><a href="#_sub5" class="code">function indentedtext = indentLines(text, indentation)</a></li><li><a href="#_sub6" class="code">function internal_assert(expression, varargin)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function writeXmlTestsuite(suiteresult, targetdir)</a>
0002 <span class="comment">% WRITEXMLTESTSUITE Write the result of a test suite as jUnit compatible XML file.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% WRITEXMLTESTSUITE(suiteresult, targetdir)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Input argument suiteresult is a structure of these fields:</span>
0007 <span class="comment">%  name           the package name of the test suite</span>
0008 <span class="comment">%  errors         the number of errors</span>
0009 <span class="comment">%  failures       the number of failures</span>
0010 <span class="comment">%  tests          the number of executed tests</span>
0011 <span class="comment">%  time           the time used for executing the tests</span>
0012 <span class="comment">%  testcaseList   a list of all testcases with specific information</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%  Input argument targetdir defines the target directory for the XML</span>
0015 <span class="comment">%  report.</span>
0016 
0017 <span class="comment">%  This Software and all associated files are released unter the</span>
0018 <span class="comment">%  GNU General Public License (GPL), see LICENSE for details.</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%  $Author: hetu $</span>
0021 <span class="comment">%  $Id: writeXmlTestsuite.m 22 2013-05-16 12:29:26Z hetu $</span>
0022   
0023    s_fileName = [<span class="string">'TEST-'</span> suiteresult.name <span class="string">'.xml'</span>];
0024 
0025    source = fullfile(targetdir, s_fileName);
0026    
0027    fid = fopen(source,<span class="string">'w'</span>);
0028    <span class="comment">% default xml headline</span>
0029    fprintf(fid,<span class="string">'&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n'</span>);
0030    <span class="comment">% wrap this string in a '%s' call in order to prohibit fprintf to parse</span>
0031    <span class="comment">% it</span>
0032    fprintf(fid, <span class="string">'%s'</span>, <a href="#_sub1" class="code" title="subfunction xml = printXmlTestsuite(suiteresult)">printXmlTestsuite</a>(suiteresult));
0033    fclose(fid);
0034 
0035 
0036 <span class="comment">%% Return XML string for test suite</span>
0037 <span class="comment">% Input argument suiteresult is a structure of these fields:</span>
0038 <span class="comment">%  name           the package name of the test suite</span>
0039 <span class="comment">%  errors         the number of errors</span>
0040 <span class="comment">%  failures       the number of failures</span>
0041 <span class="comment">%  tests          the number of executed tests</span>
0042 <span class="comment">%  time           the time used for executing the tests</span>
0043 <span class="comment">%  testcaseList   a list of all testcases with specific information</span>
0044 <a name="_sub1" href="#_subfunctions" class="code">function xml = printXmlTestsuite(suiteresult)</a>
0045 
0046    timestamp = datestr(now,<span class="string">'yyyy-mm-ddTHH:MM:SS'</span>);
0047    attributes = {<span class="string">'name'</span>, suiteresult.name, <span class="keyword">...</span>
0048                  <span class="string">'errors'</span>, num2str(suiteresult.errors), <span class="keyword">...</span>
0049                  <span class="string">'failures'</span>, num2str(suiteresult.failures), <span class="keyword">...</span>
0050                  <span class="string">'tests'</span>, num2str(suiteresult.tests), <span class="keyword">...</span>
0051                  <span class="string">'time'</span>, num2str(suiteresult.time), <span class="keyword">...</span>
0052                  <span class="string">'hostname'</span>, <span class="string">'unknown'</span>, <span class="keyword">...</span>
0053                  <span class="string">'timestamp'</span>, timestamp, <span class="keyword">...</span>
0054                 };
0055 
0056    content = <span class="string">''</span>;
0057    content = [content <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content)">xmlTag</a>(<span class="string">'properties'</span>)];
0058    <span class="keyword">for</span> tc = 1:length(suiteresult.testcaseList)
0059       content = [content <a href="#_sub2" class="code" title="subfunction xml = printXmlTestcase(testcase)">printXmlTestcase</a>(suiteresult.testcaseList{tc})]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0060    <span class="keyword">end</span>
0061    content = [content <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content)">xmlTag</a>(<span class="string">'system-out'</span>)];
0062    content = [content <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content)">xmlTag</a>(<span class="string">'system-err'</span>)];
0063    
0064    xml = <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content)">xmlTag</a>(<span class="string">'testsuite'</span>, attributes, content);
0065 
0066 
0067 <span class="comment">%% Return XML string for test case</span>
0068 <span class="comment">% List of testcase fields:</span>
0069 <span class="comment">%     .name       the test case name</span>
0070 <span class="comment">%     .classname  the name of the class/package, constructed from the</span>
0071 <span class="comment">%                 relative path name and the test suite file name</span>
0072 <span class="comment">%     .error      a description of its error. [] if no error.</span>
0073 <span class="comment">%     .failure    a description of its failure. [] if no failure.</span>
0074 <span class="comment">%     (.time)     the time used. Not supported.</span>
0075 <a name="_sub2" href="#_subfunctions" class="code">function xml = printXmlTestcase(testcase)</a>
0076 
0077    newline = sprintf(<span class="string">'\n'</span>);
0078 
0079    attributes = {<span class="string">'classname'</span>, testcase.classname, <span class="keyword">...</span>
0080                  <span class="string">'name'</span>, testcase.name};
0081                  <span class="comment">% time not available:</span>
0082                  <span class="comment">%'time', num2str(testcase.time), ...</span>
0083 
0084    content = <span class="string">''</span>;
0085    <span class="keyword">if</span> ~isempty(testcase.error)
0086       content = [content <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content)">xmlTag</a>(<span class="string">'error'</span>, {}, [<a href="#_sub3" class="code" title="subfunction message = sanitizeHtml(message)">sanitizeHtml</a>(testcase.error) newline])];
0087    <span class="keyword">end</span>
0088    <span class="keyword">if</span> ~isempty(testcase.failure)
0089       content = [content <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content)">xmlTag</a>(<span class="string">'failure'</span>, {}, [<a href="#_sub3" class="code" title="subfunction message = sanitizeHtml(message)">sanitizeHtml</a>(testcase.failure) newline])];
0090    <span class="keyword">end</span>
0091 
0092    xml = <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content)">xmlTag</a>(<span class="string">'testcase'</span>, attributes, content);
0093    
0094    
0095 <span class="comment">%% strip text off HTML characters</span>
0096 <a name="_sub3" href="#_subfunctions" class="code">function message = sanitizeHtml(message)</a>
0097    
0098    message = strrep(message,<span class="string">'&lt;'</span>,<span class="string">'('</span>);
0099    message = strrep(message,<span class="string">'&gt;'</span>,<span class="string">')'</span>);
0100 
0101 
0102 <span class="comment">%% Return XML formatted tag from</span>
0103 <span class="comment">%   - tagname string</span>
0104 <span class="comment">%   - attributes cell string array</span>
0105 <span class="comment">%   - content string</span>
0106 <a name="_sub4" href="#_subfunctions" class="code">function xml = xmlTag(tagname, attributes, content)</a>
0107 
0108    <span class="keyword">if</span> nargin&lt;2, attributes={}; <span class="keyword">end</span>
0109    <span class="keyword">if</span> nargin&lt;3, content=<span class="string">''</span>; <span class="keyword">end</span>
0110 
0111    <a href="#_sub6" class="code" title="subfunction internal_assert(expression, varargin)">internal_assert</a>(nargin &gt;= 1);
0112    <a href="#_sub6" class="code" title="subfunction internal_assert(expression, varargin)">internal_assert</a>(ischar(tagname));
0113    <a href="#_sub6" class="code" title="subfunction internal_assert(expression, varargin)">internal_assert</a>(isempty(attributes) || <span class="keyword">...</span>
0114                   (iscellstr(attributes) &amp;&amp; mod(length(attributes), 2)==0));
0115    <a href="#_sub6" class="code" title="subfunction internal_assert(expression, varargin)">internal_assert</a>(ischar(content));
0116 
0117    
0118    newline = sprintf(<span class="string">'\n'</span>);
0119 
0120    <span class="comment">% start opening tag</span>
0121    xml = [<span class="string">'&lt;'</span> tagname];
0122 
0123    <span class="comment">% add attributes</span>
0124    <span class="keyword">for</span> i=1:2:length(attributes)
0125       xml = [xml <span class="string">' '</span> attributes{i} <span class="string">'=&quot;'</span> attributes{i+1} <span class="string">'&quot;'</span>]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0126    <span class="keyword">end</span>
0127    
0128    <span class="comment">% fill up to tag closing</span>
0129    <span class="keyword">if</span> isempty(content)
0130       <span class="comment">% just finish-close the opening tag in case of no content</span>
0131       xml = [xml <span class="string">'/&gt;'</span> newline];
0132    <span class="keyword">else</span>
0133       <span class="comment">% close opening tag</span>
0134       xml = [xml <span class="string">'&gt;'</span> newline];
0135 
0136       <span class="comment">% add content</span>
0137       xml = [xml <a href="#_sub5" class="code" title="subfunction indentedtext = indentLines(text, indentation)">indentLines</a>(content)];
0138 
0139       <span class="comment">% add closing tag</span>
0140       xml = [xml <span class="string">'&lt;/'</span> tagname <span class="string">'&gt;'</span> newline];
0141    <span class="keyword">end</span>
0142 
0143 
0144 <span class="comment">%% Indent lines of a given multi-line string by an indentation string</span>
0145 <a name="_sub5" href="#_subfunctions" class="code">function indentedtext = indentLines(text, indentation)</a>
0146 
0147    <span class="keyword">if</span> nargin&lt;2, indentation=<span class="string">'  '</span>; <span class="keyword">end</span>
0148 
0149    <a href="#_sub6" class="code" title="subfunction internal_assert(expression, varargin)">internal_assert</a>(nargin &gt;= 1);
0150    <a href="#_sub6" class="code" title="subfunction internal_assert(expression, varargin)">internal_assert</a>(ischar(text));
0151    <a href="#_sub6" class="code" title="subfunction internal_assert(expression, varargin)">internal_assert</a>(ischar(indentation));
0152 
0153    <span class="comment">% prepend every stream of non-newline characters by indentation</span>
0154    <span class="comment">% only prepend lines that start with a tag bracket</span>
0155    <span class="comment">% this may break tags whose attributes span multiple lines</span>
0156    indentedtext = regexprep(text, <span class="string">'(\w*&lt;[^\n]*)'</span>, [indentation <span class="string">'$1'</span>]);
0157 
0158 
0159 <span class="comment">% for backward compatibility with R2006b</span>
0160 <a name="_sub6" href="#_subfunctions" class="code">function internal_assert(expression, varargin)</a>
0161    <span class="comment">% use built-in assert if available</span>
0162    <span class="keyword">if</span> exist(<span class="string">'assert'</span>, <span class="string">'builtin'</span>) == 5
0163       assert(expression, varargin{:});
0164    <span class="keyword">elseif</span> nargin &gt; 1 &amp;&amp; ~expression
0165       <span class="keyword">if</span> isempty(varargin) || isempty(varargin{1})
0166          error(<span class="string">'AssertionError'</span>, varargin{:});
0167       <span class="keyword">else</span>
0168          error(varargin{:});
0169       <span class="keyword">end</span>
0170    <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 27-May-2013 17:32:21 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>