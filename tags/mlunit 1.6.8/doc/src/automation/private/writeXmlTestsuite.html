<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of writeXmlTestsuite</title>
  <meta name="keywords" content="writeXmlTestsuite">
  <meta name="description" content="WRITEXMLTESTSUITE Write the result of a test suite as jUnit compatible XML file.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">src</a> &gt; <a href="../index.html">automation</a> &gt; <a href="index.html">private</a> &gt; writeXmlTestsuite.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src\automation\private&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>writeXmlTestsuite
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>WRITEXMLTESTSUITE Write the result of a test suite as jUnit compatible XML file.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function writeXmlTestsuite(suiteresult, targetdir) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> WRITEXMLTESTSUITE Write the result of a test suite as jUnit compatible XML file.

 WRITEXMLTESTSUITE(suiteresult, targetdir)

 Input argument suiteresult is a structure of these fields:
  name           the package name of the test suite
  errors         the number of errors
  failures       the number of failures
  tests          the number of executed tests
  time           the time used for executing the tests
  testcaseList   a list of all testcases with specific information

  Input argument targetdir defines the target directory for the XML
  report.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function xml = printXmlTestsuite(suiteresult)</a></li><li><a href="#_sub2" class="code">function xml = printXmlTestcase(testcase)</a></li><li><a href="#_sub3" class="code">function message = sanitizeHtml(message)</a></li><li><a href="#_sub4" class="code">function xml = xmlTag(tagname, attributes, content, verbatim)</a></li><li><a href="#_sub5" class="code">function indentedtext = indentLines(text, indentation)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function writeXmlTestsuite(suiteresult, targetdir)</a>
0002 <span class="comment">% WRITEXMLTESTSUITE Write the result of a test suite as jUnit compatible XML file.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% WRITEXMLTESTSUITE(suiteresult, targetdir)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Input argument suiteresult is a structure of these fields:</span>
0007 <span class="comment">%  name           the package name of the test suite</span>
0008 <span class="comment">%  errors         the number of errors</span>
0009 <span class="comment">%  failures       the number of failures</span>
0010 <span class="comment">%  tests          the number of executed tests</span>
0011 <span class="comment">%  time           the time used for executing the tests</span>
0012 <span class="comment">%  testcaseList   a list of all testcases with specific information</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%  Input argument targetdir defines the target directory for the XML</span>
0015 <span class="comment">%  report.</span>
0016 
0017 <span class="comment">%  This Software and all associated files are released unter the</span>
0018 <span class="comment">%  GNU General Public License (GPL), see LICENSE for details.</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%  $Id$</span>
0021   
0022    s_fileName = [<span class="string">'TEST-'</span> suiteresult.name <span class="string">'.xml'</span>];
0023 
0024    source = fullfile(targetdir, s_fileName);
0025    
0026    fid = fopen(source,<span class="string">'w'</span>);
0027    <span class="keyword">if</span> fid == -1
0028        warning(<span class="string">'MLUNIT:noFileAccess'</span>, <span class="string">'Could not open file for writing: ''%s''.'</span>, source);
0029        <span class="keyword">return</span>;
0030    <span class="keyword">end</span>
0031    
0032    <span class="comment">% default xml headline</span>
0033    fprintf(fid,<span class="string">'&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n'</span>);
0034    <span class="comment">% wrap this string in a '%s' call in order to prohibit fprintf to parse</span>
0035    <span class="comment">% it</span>
0036    fprintf(fid, <span class="string">'%s'</span>, <a href="#_sub1" class="code" title="subfunction xml = printXmlTestsuite(suiteresult)">printXmlTestsuite</a>(suiteresult));
0037    fclose(fid);
0038 
0039 
0040 <span class="comment">%% Return XML string for test suite</span>
0041 <span class="comment">% Input argument suiteresult is a structure of these fields:</span>
0042 <span class="comment">%  name           the package name of the test suite</span>
0043 <span class="comment">%  errors         the number of errors</span>
0044 <span class="comment">%  failures       the number of failures</span>
0045 <span class="comment">%  tests          the number of executed tests</span>
0046 <span class="comment">%  time           the time used for executing the tests</span>
0047 <span class="comment">%  testcaseList   a list of all testcases with specific information</span>
0048 <a name="_sub1" href="#_subfunctions" class="code">function xml = printXmlTestsuite(suiteresult)</a>
0049 
0050    timestamp = datestr(now,<span class="string">'yyyy-mm-ddTHH:MM:SS'</span>);
0051    attributes = {<span class="string">'name'</span>, suiteresult.name, <span class="keyword">...</span>
0052                  <span class="string">'errors'</span>, num2str(suiteresult.errors), <span class="keyword">...</span>
0053                  <span class="string">'failures'</span>, num2str(suiteresult.failures), <span class="keyword">...</span>
0054                  <span class="string">'tests'</span>, num2str(suiteresult.tests), <span class="keyword">...</span>
0055                  <span class="string">'time'</span>, num2str(suiteresult.time), <span class="keyword">...</span>
0056                  <span class="string">'hostname'</span>, <span class="string">'unknown'</span>, <span class="keyword">...</span>
0057                  <span class="string">'timestamp'</span>, timestamp, <span class="keyword">...</span>
0058                 };
0059 
0060    content = <span class="string">''</span>;
0061    content = [content <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content, verbatim)">xmlTag</a>(<span class="string">'properties'</span>)];
0062    <span class="keyword">for</span> tc = 1:length(suiteresult.testcaseList)
0063       content = [content <a href="#_sub2" class="code" title="subfunction xml = printXmlTestcase(testcase)">printXmlTestcase</a>(suiteresult.testcaseList{tc})]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0064    <span class="keyword">end</span>
0065    content = [content <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content, verbatim)">xmlTag</a>(<span class="string">'system-out'</span>)];
0066    content = [content <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content, verbatim)">xmlTag</a>(<span class="string">'system-err'</span>)];
0067    
0068    xml = <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content, verbatim)">xmlTag</a>(<span class="string">'testsuite'</span>, attributes, content);
0069 
0070 
0071 <span class="comment">%% Return XML string for test case</span>
0072 <span class="comment">% List of testcase fields:</span>
0073 <span class="comment">%     .name       the test case name</span>
0074 <span class="comment">%     .classname  the name of the class/package, constructed from the</span>
0075 <span class="comment">%                 relative path name and the test suite file name</span>
0076 <span class="comment">%     .error      a description of its error. [] if no error.</span>
0077 <span class="comment">%     .failure    a description of its failure. [] if no failure.</span>
0078 <span class="comment">%     (.time)     the time used. Not supported.</span>
0079 <a name="_sub2" href="#_subfunctions" class="code">function xml = printXmlTestcase(testcase)</a>
0080 
0081    newline = sprintf(<span class="string">'\n'</span>);
0082 
0083    attributes = {<span class="string">'classname'</span>, testcase.classname, <span class="keyword">...</span>
0084                  <span class="string">'name'</span>, testcase.name};
0085                  <span class="comment">% time not available:</span>
0086                  <span class="comment">%'time', num2str(testcase.time), ...</span>
0087 
0088    content = <span class="string">''</span>;
0089    <span class="keyword">if</span> ~isempty(testcase.error)
0090       content = [content <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content, verbatim)">xmlTag</a>(<span class="string">'error'</span>, {}, testcase.error, true)];
0091    <span class="keyword">end</span>
0092    <span class="keyword">if</span> ~isempty(testcase.failure)
0093       content = [content <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content, verbatim)">xmlTag</a>(<span class="string">'failure'</span>, {}, testcase.failure, true)];
0094    <span class="keyword">end</span>
0095 
0096    xml = <a href="#_sub4" class="code" title="subfunction xml = xmlTag(tagname, attributes, content, verbatim)">xmlTag</a>(<span class="string">'testcase'</span>, attributes, content);
0097    
0098    
0099 <span class="comment">%% provide HTML-safe version of a message</span>
0100 <a name="_sub3" href="#_subfunctions" class="code">function message = sanitizeHtml(message)</a>
0101    
0102    message = [<span class="string">'&lt;![CDATA['</span> message <span class="string">']]&gt;'</span>];
0103 
0104 
0105 <span class="comment">%% Return XML formatted tag from</span>
0106 <span class="comment">%   - tagname string</span>
0107 <span class="comment">%   - attributes cell string array</span>
0108 <span class="comment">%   - content string</span>
0109 <a name="_sub4" href="#_subfunctions" class="code">function xml = xmlTag(tagname, attributes, content, verbatim)</a>
0110 
0111    <span class="keyword">if</span> nargin&lt;2, attributes={}; <span class="keyword">end</span>
0112    <span class="keyword">if</span> nargin&lt;3, content=<span class="string">''</span>; <span class="keyword">end</span>
0113    <span class="keyword">if</span> nargin&lt;4, verbatim=false; <span class="keyword">end</span>
0114 
0115    error(nargchk(1, 4, nargin, <span class="string">'struct'</span>));
0116    <span class="keyword">if</span> ~ischar(tagname), error(<span class="string">'tagname need be char'</span>); <span class="keyword">end</span>
0117    <span class="keyword">if</span> ~ischar(content), error(<span class="string">'content need be char'</span>); <span class="keyword">end</span>
0118    <span class="keyword">if</span> ~(isempty(attributes) || (iscellstr(attributes) &amp;&amp; mod(length(attributes), 2)==0))
0119       error(<span class="string">'attributes need be empty, or cellstr of even length'</span>);
0120    <span class="keyword">end</span>
0121    <span class="keyword">if</span> ~islogical(verbatim) || numel(verbatim)~=1, error(<span class="string">'verbatim need be scalar logical'</span>); <span class="keyword">end</span>
0122    
0123    
0124    newline = sprintf(<span class="string">'\n'</span>);
0125 
0126    <span class="comment">% start opening tag</span>
0127    xml = [<span class="string">'&lt;'</span> tagname];
0128 
0129    <span class="comment">% add attributes</span>
0130    <span class="keyword">for</span> i=1:2:length(attributes)
0131       xml = [xml <span class="string">' '</span> attributes{i} <span class="string">'=&quot;'</span> attributes{i+1} <span class="string">'&quot;'</span>]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0132    <span class="keyword">end</span>
0133    
0134    <span class="comment">% fill up to tag closing</span>
0135    <span class="keyword">if</span> isempty(content)
0136       <span class="comment">% just finish-close the opening tag in case of no content</span>
0137       xml = [xml <span class="string">'/&gt;'</span> newline];
0138    <span class="comment">% add verbatim content</span>
0139    <span class="keyword">elseif</span> verbatim
0140       <span class="comment">% make sure to not include unnecessary whitespace and newline between</span>
0141       <span class="comment">% the tag enclosings, also make sure the content is displayed as is</span>
0142       xml = [xml <span class="string">'&gt;'</span> <a href="#_sub3" class="code" title="subfunction message = sanitizeHtml(message)">sanitizeHtml</a>(content) <span class="string">'&lt;/'</span> tagname <span class="string">'&gt;'</span> newline];
0143    <span class="comment">% add normal content</span>
0144    <span class="keyword">else</span>
0145       <span class="comment">% close opening tag</span>
0146       xml = [xml <span class="string">'&gt;'</span> newline];
0147 
0148       <span class="comment">% add content</span>
0149       xml = [xml <a href="#_sub5" class="code" title="subfunction indentedtext = indentLines(text, indentation)">indentLines</a>(content)];
0150 
0151       <span class="comment">% add closing tag</span>
0152       xml = [xml <span class="string">'&lt;/'</span> tagname <span class="string">'&gt;'</span> newline];
0153    <span class="keyword">end</span>
0154 
0155 
0156 <span class="comment">%% Indent lines of a given multi-line string by an indentation string</span>
0157 <a name="_sub5" href="#_subfunctions" class="code">function indentedtext = indentLines(text, indentation)</a>
0158 
0159    <span class="keyword">if</span> nargin&lt;2, indentation=<span class="string">'  '</span>; <span class="keyword">end</span>
0160 
0161    error(nargchk(1, 2, nargin, <span class="string">'struct'</span>));
0162    <span class="keyword">if</span> ~ischar(text), error(<span class="string">'text need be char'</span>); <span class="keyword">end</span>
0163    <span class="keyword">if</span> ~ischar(indentation), error(<span class="string">'indentation need be char'</span>); <span class="keyword">end</span>
0164 
0165    <span class="comment">% prepend by indentation every tag bracket that starts a new line</span>
0166    indentedtext = regexprep(text, <span class="string">'^(\s*&lt;)'</span>, [indentation <span class="string">'$1'</span>], <span class="string">'lineanchors'</span>);</pre></div>
<hr><address>Generated on Tue 14-Apr-2015 12:19:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>